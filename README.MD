<h1 align="center"

## üìù Sobre o Projeto com FastAPI

Este projeto √© uma aplica√ß√£o backend constru√≠da com **FastAPI**, projetada para gerenciar usu√°rios, pap√©is, permiss√µes e transa√ß√µes em um sistema baseado em **Role-Based Access Control (RBAC)**. A API suporta autentica√ß√£o via JWT, autoriza√ß√£o granular, auditoria de a√ß√µes e integra√ß√£o com um banco de dados usando SQLAlchemy como ORM. 
</h1>

<p align="center">
   Este projeto utiliza o FastAPI para servir uma API
</p>

<p align="center">
  <a href="#üìù-sobre-o-projeto">Sobre o Projeto</a> ‚Ä¢
  <a href="#üöÄ-tecnologias">Tecnologias</a> ‚Ä¢
  <a href="#üìã-requisitos">Requisitos</a> ‚Ä¢
  <a href="#üîß-arquitetura">Arquitetura</a> ‚Ä¢
  <a href="#‚öôÔ∏è-como-usar">Como Usar</a> ‚Ä¢
  <a href="#ü§ù-como-contribuir">Como Contribuir</a> ‚Ä¢
  <a href="#üìÑ-licen√ßa">Licen√ßa</a>
</p>

---

Este projeto √© uma aplica√ß√£o backend constru√≠da com **FastAPI**, projetada para gerenciar usu√°rios, pap√©is, permiss√µes e transa√ß√µes em um sistema baseado em **Role-Based Access Control (RBAC)**. A API suporta autentica√ß√£o via JWT, autoriza√ß√£o granular, auditoria de a√ß√µes e integra√ß√£o com um banco de dados usando SQLAlchemy como ORM.

### Funcionalidades Principais
- **Autentica√ß√£o**: Login de usu√°rios com gera√ß√£o de tokens JWT.
- **Autoriza√ß√£o**: Controle de acesso baseado em pap√©is e permiss√µes.
- **Gerenciamento de Usu√°rios**: Cria√ß√£o, atualiza√ß√£o, listagem e exclus√£o de usu√°rios.
- **Gest√£o de Pap√©is e Permiss√µes**: Atribui√ß√£o de pap√©is a usu√°rios e permiss√µes a pap√©is.
- **Auditoria**: Registro de informa√ß√µes de auditoria (usu√°rio, IP, data de cria√ß√£o/atualiza√ß√£o).
- **Testes Automatizados**: Suporte a testes com pytest e cobertura de c√≥digo.

O projeto √© estruturado para ser modular, escal√°vel e seguir boas pr√°ticas de desenvolvimento, como separa√ß√£o de responsabilidades e uso de ferramentas modernas de desenvolvimento Python.

---

## üöÄ Tecnologias

Este projeto utiliza as seguintes tecnologias e ferramentas:

- **Linguagem**: [Python 3.12](https://www.python.org/)
- **Framework**: [FastAPI](https://fastapi.tiangolo.com/) - Framework web para constru√ß√£o de APIs.
- **ORM**: [SQLAlchemy](https://www.sqlalchemy.org/) - Mapeamento objeto-relacional.
- **Banco de Dados**: [SQLite](https://sqlite.org/) - Banco de dados leve e embarcado.
- **Gerenciador de Depend√™ncias**: [Uv Astral](https://docs.astral.sh/uv/) - Gerenciamento de depend√™ncias e ambientes virtuais.
- **Migra√ß√µes**: [Alembic](https://alembic.sqlalchemy.org/) - Gerenciamento de migra√ß√µes de banco de dados.
- **Testes**: [pytest](https://pytest.org/) com [pytest-cov](https://pytest-cov.readthedocs.io/) para cobertura de testes.
- **Linting e Formata√ß√£o**: [Ruff](https://github.com/charliermarsh/ruff), [Blue](https://blue.readthedocs.io/), e [isort](https://pycqa.github.io/isort/) para manter o c√≥digo limpo.
- **Autentica√ß√£o**: [python-jose](https://github.com/mpdavis/python-jose) para JWT e [bcrypt](https://pypi.org/project/bcrypt/) para hash de senhas.

---

## üìã Requisitos

Para rodar ou contribuir com o projeto, voc√™ precisar√° das seguintes ferramentas instaladas:

| Ferramenta                                         | Vers√£o       | Instala√ß√£o (Linux/macOS)                     |
|----------------------------------------------------|--------------|----------------------------------------------|
| [Python](https://www.python.org/)                  | 3.12       | `asdf install python 3.12` ou similar      |
| [UV](https://docs.astral.sh/uv/)                   | Latest       | `curl -LsSf https://astral.sh/uv/install.sh | sh |
| [Git](https://git-scm.com/)                        | Latest       | `sudo apt install git` (Linux) ou `brew install git` (macOS) |
| [SQLite](https://sqlite.org/)                      | Latest       | Geralmente pr√©-instalado, ou `sudo apt install sqlite3` |

**Nota**: Recomendamos o uso do `asdf` para gerenciar vers√µes do Python. Consulte o arquivo `.python-version` para a vers√£o exata do Python utilizada.

---

## üîß Arquitetura

A estrutura do projeto √© organizada para promover modularidade e facilitar a manuten√ß√£o. Abaixo est√° a organiza√ß√£o dos arquivos e diret√≥rios:

```bash
FastAPI/
‚îú‚îÄ‚îÄ app/                        # C√≥digo-fonte principal da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ api/                    # Defini√ß√£o de rotas, controladores e esquemas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assignment/         # Endpoints para designa√ß√µes (usu√°rio-papel)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authentication/     # Endpoints para autentica√ß√£o (login, JWT)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authorization/      # Endpoints para autoriza√ß√µes (papel-transa√ß√£o)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ role/               # Endpoints para gerenciamento de pap√©is
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transaction/        # Endpoints para gerenciamento de transa√ß√µes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user/               # Endpoints para gerenciamento de usu√°rios
‚îÇ   ‚îú‚îÄ‚îÄ database/               # Configura√ß√£o do banco de dados (SQLAlchemy)
‚îÇ   ‚îú‚îÄ‚îÄ models/                 # Modelos ORM para as entidades do sistema
‚îÇ   ‚îú‚îÄ‚îÄ utils/                  # Fun√ß√µes utilit√°rias (seguran√ßa, configura√ß√µes, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ startup.py              # Inicializa√ß√£o da aplica√ß√£o FastAPI
‚îú‚îÄ‚îÄ migrations/                 # Scripts de migra√ß√£o do banco de dados (Alembic)
‚îú‚îÄ‚îÄ seeds/                      # Scripts de seeds para a aplica√ß√£o
‚îú‚îÄ‚îÄ tests/                      # Testes automatizados (pytest)
‚îú‚îÄ‚îÄ DOCS/                      # Documenta√ß√£o detalhada
‚îú‚îÄ‚îÄ .secrets/                   # Arquivos sens√≠veis (ex.: SECURITY_API_SECRET_KEY)
‚îú‚îÄ‚îÄ .env-semple                 # Modelo para arquivo de configura√ß√£o .env
‚îú‚îÄ‚îÄ alembic.ini                 # Configura√ß√£o do Alembic
‚îú‚îÄ‚îÄ uv.lock                    # Lockfile do uv com depend√™ncias fixas
‚îú‚îÄ‚îÄ pyproject.toml              # Configura√ß√£o do projeto e depend√™ncias
‚îú‚îÄ‚îÄ .gitignore                  # Arquivos e pastas ignorados pelo Git
‚îú‚îÄ‚îÄ .tool-versions              # Vers√µes das ferramentas utilizadas
```

### Modelo de Dados
O projeto utiliza um modelo de dados baseado em RBAC, com as seguintes entidades principais:
- **User**: Representa os usu√°rios do sistema.
- **Role**: Pap√©is que definem permiss√µes.
- **Assignment**: Associa usu√°rios a pap√©is.
- **Transaction**: Opera√ß√µes do sistema (ex.: criar, listar, excluir).
- **Authorization**: Associa pap√©is a transa√ß√µes, definindo permiss√µes.

---

## üìö Documenta√ß√£o T√©cnica

Para informa√ß√µes t√©cnicas detalhadas sobre o projeto, consulte os documentos espec√≠ficos:

### üìä **Modelo de Entidades e Relacionamentos**
- **Diagrama ER**: [DOCS/MODELS.png](DOCS/MODELS.png) - Visualiza√ß√£o completa das entidades e seus relacionamentos no banco de dados.

### üîê **Sistema de Autentica√ß√£o (JWT)**
- **Guia Completo**: [DOCS/AUTHENTICATION.MD](DOCS/AUTHENTICATION.MD) - Documenta√ß√£o detalhada sobre:
  - Fluxo de autentica√ß√£o com JWT
  - Como obter e usar tokens de acesso
  - Estrutura e valida√ß√£o de tokens JWT
  - Seguran√ßa de senhas com BCrypt
  - Integra√ß√£o com o sistema de autoriza√ß√£o
  - Cen√°rios pr√°ticos e exemplos de c√≥digo

### üîê **Sistema de Permiss√µes (RBAC)**
- **Guia Completo**: [DOCS/PERMISSIONS.MD](DOCS/PERMISSIONS.MD) - Documenta√ß√£o detalhada sobre:
  - Como um usu√°rio novo ganha permiss√µes
  - Como criar novas permiss√µes no sistema
  - Estrutura hier√°rquica de roles
  - Cen√°rios pr√°ticos de uso
  - Sistema de seguran√ßa e valida√ß√µes

### üîÑ **Fluxograma da Aplica√ß√£o**
- **Fluxo T√©cnico**: [DOCS/FLUXOGRAMA.MD](DOCS/FLUXOGRAMA.MD) - Mapeamento completo dos fluxos da aplica√ß√£o:
  - Pontos de entrada (endpoints)
  - Pontos de decis√£o (middlewares e valida√ß√µes)
  - Pontos de sa√≠da (respostas e persist√™ncia)
  - Agrupamentos naturais do sistema

### üöÄ **Deploy**
- **Guia Completo**: [DOCS/DEPLOYMENT.md](DOCS/DEPLOYMENT.md) - Documenta√ß√£o detalhada sobre:
  - Configura√ß√£o do ambiente de produ√ß√£o com Docker
  - Setup com PostgreSQL e Docker Compose
  - Comandos para gerenciamento de containers
  - Backup e restaura√ß√£o do banco de dados
  - Considera√ß√µes de seguran√ßa e performance
  - Troubleshooting de problemas comuns

---

## ‚öôÔ∏è Como Usar

Siga os passos abaixo para configurar e executar o projeto localmente.

### 1. Clonar o Reposit√≥rio
```bash
git clone https://github.com/jvras58/FastAPI
cd FastAPI
```

## 2.1 Montando o ambiente

Este reposit√≥rio esta organizando em um devcontainer.
E para instacia-lo no VSCODE √© recomendado as seguintes configura√ß√µes:

#### Exten√ß√µes recomendadas

- Name: Remote Development
- Id: ms-vscode-remote.vscode-remote-extensionpack
- Description: An extension pack that lets you open any folder in a container, on a remote machine, or in WSL and take advantage of VS Code's full feature set.
- Version: 0.25.0
- Publisher: Microsoft
- VSCode Marketplace Link: https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack

#### Docker Engine

√â obrigat√≥rio ter o Docker Engine j√° instalado e cunfigurado. Para mais informa√ß√µes de como instalar o Docker Engine em seu SO, ver em:

- Instru√ß√µes para instala√ß√£o do Docker Engine: [Ver o link](https://docs.docker.com/engine/install/)

#### Procedimento para instanciar o projeto no VSCODE
1. Com o pack de exten√ß√µes instalado,
1. Realize o clone/fork deste reposit√≥rio,
1. Abra o diretorio deste repositorio no VSCODE como um projeto,
1. Use o Comando _Dev Containers: Reopen in Container_ da paleta de comandos do VSCODE. _(F1, Ctrl+Shift+P)_.

Depois da compila√ß√£o do container o VSCode abrir√° o reposit√≥rio em um ambiente encapsulado e executando diretamente de dentro do container como configurado nas defini√ß√µes do **/.devconainer**.

---

### 2.2 Configurar o Ambiente
Crie o arquivo `.env` baseado no modelo fornecido:
```bash
cp .env-semple .env
```

Edite o arquivo `.env` com as configura√ß√µes adequadas. Exemplo:
```plaintext
DB_URL="sqlite:///database.db"
SECURITY_ALGORITHM="HS256"
SECURITY_ACCESS_TOKEN_EXPIRE_MINUTES=30
```

Crie o diret√≥rio `.secrets` e adicione o arquivo `SECURITY_API_SECRET_KEY` com um valor seguro:
```bash
mkdir .secrets
echo "SUA_CHAVE_SECRETA_AQUI" > .secrets/SECURITY_API_SECRET_KEY
```

### 3. Instalar Depend√™ncias
Ative o ambiente virtual e instale as depend√™ncias com o UV:
```bash
uv sync
uv install
```
> Entre no ambiente virtual: source activate_env.sh

### 4. Aplicar Migra√ß√µes
Execute as migra√ß√µes para criar as tabelas no banco de dados:
A) aplique as migrations existentes:
```bash
alembic upgrade head
```
b) Suba os seedings de RBAC e de usuario admin
```bash
task setup_db
```

### 5. Executar a API
Inicie o servidor FastAPI com o comando:
```bash
task run
```

A API estar√° dispon√≠vel em:
- **URL Local**: [http://localhost:8000](http://localhost:8000)
- **Documenta√ß√£o Interativa**: [http://localhost:8000/api/v1/docs](http://localhost:8000/api/v1/docs) (Swagger UI)
- **Documenta√ß√£o Alternativa**: [http://localhost:8000/api/v1/redoc](http://localhost:8000/api/v1/redoc) (ReDoc)

### 6. Executar Testes
Para rodar os testes automatizados e verificar a cobertura:
```bash
task test
```

O relat√≥rio de cobertura ser√° gerado em `htmlcov/index.html`.

---

## ü§ù Como Contribuir

Contribui√ß√µes s√£o sempre bem-vindas! Para contribuir com o projeto:

1. **Fork** o reposit√≥rio
2. Crie uma **branch** para sua feature (`git checkout -b feature/nova-feature`)
3. **Commit** suas mudan√ßas (`git commit -m 'Adiciona nova feature'`)
4. **Push** para a branch (`git push origin feature/nova-feature`)
5. Abra um **Pull Request**

### Padr√µes de Contribui√ß√£o
- Siga as conven√ß√µes de c√≥digo estabelecidas
- Escreva testes para novas funcionalidades
- Mantenha a documenta√ß√£o atualizada
- Use mensagens de commit descritivas

---

## üìÑ Licen√ßa

Este projeto est√° licenciado sob a [MIT License](LICENSE). Veja o arquivo `LICENSE` para mais detalhes.

---

## üí¨ Contato

Se tiver d√∫vidas ou sugest√µes, entre em contato:
- **Autores**: jvras <jvras58@gmail.com>
